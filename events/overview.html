<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Events | Shuttle.Recall</title>
    <meta name="description" content="Shuttle.Recall Documentation">
    <link rel="stylesheet" href="/shuttle-recall/assets/style.eed3cbe6.css">
    <link rel="modulepreload" href="/shuttle-recall/assets/app.adabc9dd.js">
    <link rel="modulepreload" href="/shuttle-recall/assets/events_overview.md.1e25aeda.lean.js">
    <link rel="prefetch" href="/shuttle-recall/assets/chunks/VPAlgoliaSearchBox.083d2d64.js">
    <link rel="preload" href="/assets/inter-latin.7b37fe23.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script>(()=>{const e=localStorage.getItem("shuttle-theme-appearance");(!e||e==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  <link rel="shortcut icon" href="/shuttle-recall/favicon.ico">
  <meta name="twitter:title" content="Events | Shuttle.Recall">
  <meta property="og:title" content="Events | Shuttle.Recall">
  </head>
  <body>
    <div id="app"><div class="VPApp" data-v-51944a74><!--[--><span tabindex="-1" data-v-2fe6c59b></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-2fe6c59b> Skip to content </a><!--]--><!----><!--[--><!--]--><header class="VPNav nav-bar" data-v-51944a74 data-v-1ffe764b><div class="VPNavBar" data-v-1ffe764b data-v-b188a8fc><div class="container" data-v-b188a8fc><a class="VPNavBarTitle" href="/shuttle-recall/" data-v-b188a8fc data-v-306233cb><svg width="512" height="512" version="1.1" viewbox="0 0 128 128" xmlns="http://www.w3.org/2000/svg" class="logo" data-v-306233cb><path d="m64.139 127.96s-12.139-23.959-12.136-31.963c0.0027-6.5728 5.0091-11.76 11.578-11.989s12.458 5.4443 12.458 11.992c0 7.9766-11.9 31.959-11.9 31.959zm-0.50447-127.76c-5.7902 6.2179-11.795 12.395-16.099 19.783-2.5604 4.3363-4.1582 9.2421-4.5101 14.274-0.55097 7.0293 0.72766 14.022 1.9411 20.916-4.8588 4.3344-9.9262 8.787-12.855 14.723-2.2723 4.4695-2.7019 9.6139-2.3081 14.544 0.60018 7.6433 2.6188 15.073 4.4273 22.497 3.6324-6.2122 6.6771-12.771 10.685-18.761 1.7698-2.6855 3.964-5.1433 6.7463-6.8072 3.7165-2.3199 8.028-3.6246 12.338-4.0278 5.6194 0.5367 11.332 2.5795 15.548 6.4898 3.202 3.191 5.3949 7.2064 7.6184 11.099 2.2107 3.9976 4.3198 8.0503 6.603 12.007 1.9266-7.9475 4.134-15.916 4.5215-24.125 0.21251-4.5798-0.4492-9.2939-2.6353-13.376-2.966-5.7157-7.8886-10.038-12.623-14.263 1.369-7.7989 2.8483-15.793 1.6077-23.713-0.89778-6.1259-3.9184-11.698-7.5517-16.622-3.9431-5.3615-8.5513-10.178-13.089-15.028zm0.4668 24.498c3.1449-1.77e-4 5.8916 2.5563 6.5508 5.6152 0.8638 3.4327-0.88547 7.4537-4.2441 8.791-2.6461 1.136-5.9064 0.15395-7.6172-2.127-2.5378-3.1172-2.1006-8.1998 1.0423-10.749 1.1817-0.99564 2.7206-1.5571 4.2682-1.5305z" fill="#f60"></path></svg><span class="text" data-v-306233cb>Shuttle.Recall</span></a><div class="content" data-v-b188a8fc><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-b188a8fc data-v-782d1ba1><span id="main-nav-aria-label" class="visually-hidden" data-v-782d1ba1>Main Navigation</span><!--[--><!--[--><a class="vt-link link VPNavBarMenuLink active" href="/shuttle-recall/events/overview.html" data-v-782d1ba1 data-v-32544593><!--[-->Events<!--]--><!----></a><!--]--><!--[--><a class="vt-link link VPNavBarMenuLink" href="/shuttle-recall/projections/overview.html" data-v-782d1ba1 data-v-32544593><!--[-->Projections<!--]--><!----></a><!--]--><!--]--></nav><div class="VPNavBarAppearance appearance" data-v-b188a8fc data-v-6926af2c><button class="vt-switch vt-switch-appearance" type="button" role="switch" aria-label="toggle dark mode" data-v-6926af2c><span class="vt-switch-check"><span class="vt-switch-icon"><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-sun"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-moon"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="vt-social-links VPNavBarSocialLinks social-links" data-v-b188a8fc data-v-069b6e4c><!--[--><a class="vt-social-link is-small" href="https://github.com/Shuttle/shuttle-recall" title="github" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-social-link-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden">github</span></a><!--]--></div><div class="vt-flyout VPNavBarExtra extra" ref_key="elRef" data-v-b188a8fc data-v-31683dae><button type="button" class="vt-flyout-button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-flyout-button-icon"><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="vt-flyout-menu"><div class="vt-menu"><!----><!--[--><!--[--><div class="vt-menu-group" data-v-31683dae><div class="vt-menu-item item" data-v-31683dae><p class="vt-menu-label" data-v-31683dae>Appearance</p><div class="vt-menu-action action" data-v-31683dae><button class="vt-switch vt-switch-appearance" type="button" role="switch" aria-label="toggle dark mode" data-v-31683dae><span class="vt-switch-check"><span class="vt-switch-icon"><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-sun"><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-switch-appearance-moon"><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="vt-menu-group" data-v-31683dae><div class="vt-menu-item item" data-v-31683dae><div class="vt-social-links social-links" data-v-31683dae><!--[--><a class="vt-social-link is-small" href="https://github.com/Shuttle/shuttle-recall" title="github" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-social-link-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden">github</span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><button type="button" class="vt-hamburger VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-b188a8fc data-v-0432c6a1><span class="vt-hamburger-container"><span class="vt-hamburger-top"></span><span class="vt-hamburger-middle"></span><span class="vt-hamburger-bottom"></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-51944a74 data-v-fb25d52a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-fb25d52a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-fb25d52a><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-fb25d52a>Menu</span></button><a class="top-link" href="#" data-v-fb25d52a>Return to top</a></div><aside ref_key="navEl" class="VPSidebar" data-v-51944a74 data-v-19a11deb><nav id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-19a11deb><!--[--><!--]--><span id="sidebar-aria-label" class="visually-hidden" data-v-19a11deb>Sidebar Navigation</span><!--[--><div class="group" data-v-19a11deb><section class="VPSidebarGroup" data-v-19a11deb data-v-aea56594><div class="title" data-v-aea56594><h2 class="title-text" data-v-aea56594>Events</h2></div><!--[--><a class="link" href="/shuttle-recall/events/overview.html" data-v-aea56594 data-v-c7c1a878><p class="link-text" data-v-c7c1a878>Overview</p></a><!--]--></section></div><div class="group" data-v-19a11deb><section class="VPSidebarGroup" data-v-19a11deb data-v-aea56594><div class="title" data-v-aea56594><h2 class="title-text" data-v-aea56594>Implementations</h2></div><!--[--><a class="link" href="/shuttle-recall/events/sql.html" data-v-aea56594 data-v-c7c1a878><p class="link-text" data-v-c7c1a878>SQL</p></a><!--]--></section></div><!--]--><!--[--><!--]--></nav></aside><div id="VPContent" class="VPContent has-sidebar" data-v-51944a74 data-v-872d2d9c><div class="VPContentDoc has-aside has-sidebar" data-v-872d2d9c data-v-82173214><div class="container" data-v-82173214><div class="aside" data-v-82173214><div class="aside-container" data-v-82173214><!--[--><!--]--><div class="VPContentDocOutline" ref_key="container" data-v-82173214 data-v-3a2803d6><div class="outline-marker" data-v-3a2803d6></div><div class="outline-title" data-v-3a2803d6>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-3a2803d6><span id="doc-outline-aria-label" class="visually-hidden" data-v-3a2803d6>Table of Contents for current page</span><ul class="root" data-v-3a2803d6><!--[--><li style="" data-v-3a2803d6><a class="outline-link" href="#eventstore" data-v-3a2803d6>EventStore</a><!----></li><li style="" data-v-3a2803d6><a class="outline-link" href="#eventstream" data-v-3a2803d6>EventStream</a><!----></li><li style="" data-v-3a2803d6><a class="outline-link" href="#ikeystore" data-v-3a2803d6>IKeyStore</a><!----></li><li style="" data-v-3a2803d6><a class="outline-link" href="#itypestore" data-v-3a2803d6>ITypeStore</a><!----></li><!--]--></ul></nav></div><!--[--><!--]--><!----><!--[--><!--]--></div></div><div class="content" data-v-82173214><!--[--><!--]--><main data-v-82173214><div style="position:relative;" class="vt-doc events" data-v-82173214><div><h1 id="events" tabindex="-1">Events <a class="header-anchor" href="#events" aria-hidden="true">#</a></h1><h2 id="eventstore" tabindex="-1">EventStore <a class="header-anchor" href="#eventstore" aria-hidden="true">#</a></h2><p>An <code>EventStream</code> contains events for a given <code>Guid</code> identifier and is kept outside of your object at all times. You do not need to keep track of the events (old or new) in a list within your object.</p><p>Your domain object should only be concerned about handling the relevant commands issued to it and returning one or more events from those methods. These will then be added to your <code>EventStream</code> before being persisted using an <code>IEventStore</code> implementation.</p><div class="language-c#"><pre><code><span class="line"><span style="color:#FFCB6B;">IEventStore</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">store</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EventStore</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">aggregate</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Aggregate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Guid</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">NewGuid</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">eventStream</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">aggregate</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Id</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">eventStream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddEvent</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">aggregate</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Move</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">moveCommand</span><span style="color:#89DDFF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eventStream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ShouldSnapshot</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    eventStream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddSnapshot</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">aggregate</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">State</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SaveEventStream</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eventStream</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">eventStream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">aggregate</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Id</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">IsFalse</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eventStream</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IsEmpty</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Remove</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">aggregate</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Id</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">eventStream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">aggregate</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Id</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Assert</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">IsTrue</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">eventStream</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">IsEmpty</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><h2 id="eventstream" tabindex="-1">EventStream <a class="header-anchor" href="#eventstream" aria-hidden="true">#</a></h2><p>Typically you would not create an <code>EventStream</code> directly but rather make use of an <code>IEventStore</code> implementation. You would, however, add events to an <code>EventStream</code> and call the <code>Apply</code> method to apply all events within the stream to a given object.</p><p>An event stream has a <code>Guid</code> identifier that is the surrogate key used by the <code>IEventStore</code> for your aggregate. It also has a version number that starts at 0. Each time an event is added to the stream the version is incremented by 1 <strong>and</strong> the version number is assigned to the event. This version is also used to check for concurrency violations. When you <code>Get</code> an <code>EventStream</code> from an <code>IEventStore</code> implementation the initial version is saved. When you try to save the event stream and the version of the event stream in the store does not match the initial version of the stream an <code>EventStreamConcurrencyException</code> should be raised by the <code>IEventStore</code> implementation.</p><p>As you can imagine, over time an <code>EventStream</code> may become quite large. A <code>Snapshot</code> is just an ordinary event that is added as a snapshot and contains the current state of your aggregate. Since a snapshot is an event it has a specific version number. If the <code>IEventStore</code> finds a snapshot it is first applied and all events after the sansphot&#39;s version number are loaded and applied. In this way you can cut down on the number of events loaded. You can delete the snapshot at any time as all the events will then simply be loaded and a new snapshot can be added to the event stream if required.</p><h3 id="constructor" tabindex="-1">Constructor <a class="header-anchor" href="#constructor" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">EventStream</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">EventStream</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">version</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IEnumerable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Event</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">events</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Event</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">snapshot</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>Creates a new <code>EventStream</code> instance wityh the given properties.</p><h3 id="properties" tabindex="-1">Properties <a class="header-anchor" href="#properties" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> Guid Id </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">set</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> int Version </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">set</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> Event Snapshot </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">set</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> bool Removed </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">set</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="remove" tabindex="-1">Remove <a class="header-anchor" href="#remove" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Remove</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>This will set the <code>Removed</code> property to <code>true</code>. When the <code>EventStream</code> is saved using an <code>IEventStore</code> implementation it is the responsibility of the event store to remove all the events associated with the <code>Id</code>.</p><h3 id="isempty" tabindex="-1">IsEmpty <a class="header-anchor" href="#isempty" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> bool IsEmpty</span></span>
<span class="line"></span></code></pre></div><p>Returns <code>true</code> if there are no events in the stream; else <code>false</code>.</p><h3 id="commitversion" tabindex="-1">CommitVersion <a class="header-anchor" href="#commitversion" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CommitVersion</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>Makes the initial version of the stream the current version.</p><h3 id="addevent" tabindex="-1">AddEvent <a class="header-anchor" href="#addevent" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AddEvent</span><span style="color:#89DDFF;">(object</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>Adds a new event to the stream. This is any instance of any class. Events will be defined by your domain:</p><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ItemAdded</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ProductId</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">set</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Description</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">set</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">decimal</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Price</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">set</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">stream</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EventStream</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Guid</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">NewGuid</span><span style="color:#89DDFF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">itemAdded</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ItemAdded</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            ProductId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Guid</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">NewGuid</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#A6ACCD;">            Description </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SampleItem</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            Price </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">125.50</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span></span>
<span class="line"><span style="color:#A6ACCD;">stream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddEvent</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">itemAdded</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>It will be up to the event store implementation to serialize the event data and persist it.</p><h3 id="addsnapshot" tabindex="-1">AddSnapshot <a class="header-anchor" href="#addsnapshot" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AddSnapshot</span><span style="color:#89DDFF;">(object</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>Similar to the <code>AddEvent</code> method, the <code>AddSnapshot</code> method is used to add an object that represents the complete state of the aggregate at any point in time. It is essentially handled in the same way an event is. When a snapshot is available it is loaded first and then all events following the snapshot would be loaded. It is therefore important that your aggregate state is adequately represented by the snapshot object.</p><h3 id="shouldsnapshot" tabindex="-1">ShouldSnapshot <a class="header-anchor" href="#shouldsnapshot" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">bool</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ShouldSnapshot</span><span style="color:#89DDFF;">(int</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">snapshotEventCount</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>Returns <code>true</code> if there are at least the <code>snapshotEventCount</code> number of events in the stream; else <code>false</code>. Once there are enough events in the stream a snapshot can be made.</p><h3 id="attemptsnapshot" tabindex="-1">AttemptSnapshot <a class="header-anchor" href="#attemptsnapshot" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">bool</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AttemptSnapshot</span><span style="color:#89DDFF;">(int</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">snapshotEventCount</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>This method works in conjunction with the <code>Apply</code> method. When an object instance is provided to the <code>Apply</code> method Recall will check whether the object implements the <code>ICanSnapshot</code> interface. If it does it means that the object can return a snapshot from the implement <code>GetSnapshotEvent</code> method.</p><p>The <code>AttemptSnaphot</code> will add a snapshot and return <code>true</code> if a snapshot could be added; else no snapshot will be added and <code>false</code> is returned.</p><h3 id="cansnapshot" tabindex="-1">CanSnapshot <a class="header-anchor" href="#cansnapshot" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> bool CanSnapshot </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Returns <code>true</code> if the object supplied to the <code>Apply</code> method implements the <code>ICanSnapshot</code> interface.</p><h3 id="eventsafter" tabindex="-1">EventsAfter <a class="header-anchor" href="#eventsafter" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IEnumerable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Event</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">EventsAfter</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Event</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">@event</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">public IEnumerable&lt;Event&gt; EventsAfter</span><span style="color:#89DDFF;">(int</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">version</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>Returns all the events after the given <code>version</code> or the <code>Version</code> of the given <code>@event</code>.</p><h3 id="newevents" tabindex="-1">NewEvents <a class="header-anchor" href="#newevents" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IEnumerable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Event</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">NewEvents</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>Returns all the events added that have a version number higher than the initial stream version number.</p><h3 id="pastevents" tabindex="-1">PastEvents <a class="header-anchor" href="#pastevents" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IEnumerable</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Event</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PastEvents</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><p>Returns all events before, or equal to, the initial version of the stream.</p><h3 id="apply" tabindex="-1">Apply <a class="header-anchor" href="#apply" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Apply</span><span style="color:#89DDFF;">(object</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">instance</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">public void Apply</span><span style="color:#89DDFF;">(object</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">instance</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">eventHandlingMethodName</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>Applies all the events in the stream against the given object by finding a method with the <code>eventHandlingMethodName</code>. The default name used is <code>On</code>. For each event type you would then need to have a <code>public</code> method with the relevant name that takes an instance of the event:</p><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">On</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Sample</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">Events</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">v1</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">SomeEvent</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">someEvent</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    _someData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> someEvent</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SomeData</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="hassnapshot" tabindex="-1">HasSnapshot <a class="header-anchor" href="#hassnapshot" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> bool HasSnapshot </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Returns <code>true</code> if the stream contains a snapshot; else <code>false</code>.</p><h3 id="concurrencyinvariant" tabindex="-1">ConcurrencyInvariant <a class="header-anchor" href="#concurrencyinvariant" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ConcurrencyInvariant</span><span style="color:#89DDFF;">(int</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">expectedVersion</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>If the event stream&#39;s version is not at the <code>expectedVersion</code> an <code>EventStreamConcurrencyException</code> is thrown.</p><h3 id="emptyinvariant" tabindex="-1">EmptyInvariant <a class="header-anchor" href="#emptyinvariant" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">EmptyInvariant</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">this</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EventStream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">stream</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>If the stream is empty an <code>EventStreamEmptyException</code> is thrown.</p><h1 id="ieventstore" tabindex="-1">IEventStore <a class="header-anchor" href="#ieventstore" aria-hidden="true">#</a></h1><p>An <code>IEventStore</code> implementation should be able to persis and retireve an <code>EventStream</code>:</p><h3 id="get" tabindex="-1">Get <a class="header-anchor" href="#get" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#FFCB6B;">EventStream</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Get</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>Returns a populated <code>EventStream</code> with any available snapshot applied.</p><h3 id="getraw" tabindex="-1">GetRaw <a class="header-anchor" href="#getraw" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#FFCB6B;">EventStream</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">GetRaw</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>Returns a populated <code>EventStream</code> that contains all events from version 0. No snapshot is applied.</p><h3 id="remove-1" tabindex="-1">Remove <a class="header-anchor" href="#remove-1" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Remove</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>All events that belong to the given <code>id</code> are removed.</p><h3 id="saveeventstream" tabindex="-1">SaveEventStream <a class="header-anchor" href="#saveeventstream" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SaveEventStream</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">EventStream</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">eventStream</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>Persists the given <code>EventStream</code>. If it contains a snapshot the snapshot is also saved.</p><h2 id="ikeystore" tabindex="-1">IKeyStore <a class="header-anchor" href="#ikeystore" aria-hidden="true">#</a></h2><p>You are bound to run into situations where you have a business or other key that is required to be unique. Given that the <code>IEventStore</code> makes use of only surrogate keys the <code>IKeyStore</code> is used to create a unique list of keys associated with a given aggregate identifier.</p><p>Since the keys used in the key store have to be unique you should ensure that they contain enough information to be unique and have the intended meaning.</p><p>A key could be something such as <code>order-number:ord-001/2016</code> or even <code>customer-onboarding:id-number=0000005555089</code>.</p><h3 id="contains" tabindex="-1">Contains <a class="header-anchor" href="#contains" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#89DDFF;">bool</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Contains</span><span style="color:#89DDFF;">(string</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">key</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>Returns <code>true</code> if the given <code>key</code> has an associated aggregate identifier.</p><h3 id="get-1" tabindex="-1">Get <a class="header-anchor" href="#get-1" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#FFCB6B;">Guid</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Get</span><span style="color:#89DDFF;">(string</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">key</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>Returns the <code>Guid</code> associated with the given key; else <code>null</code>.</p><h3 id="remove-2" tabindex="-1">Remove <a class="header-anchor" href="#remove-2" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Remove</span><span style="color:#89DDFF;">(string</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">key</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Remove</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>When specifying the <code>key</code> the assocation with the identifier will be removed. When specifying the <code>id</code> all keys associated with the given <code>id</code> will be removed.</p><h3 id="add" tabindex="-1">Add <a class="header-anchor" href="#add" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Add</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">key</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>Createds an association between the <code>id</code> and the <code>key</code>.</p><h2 id="itypestore" tabindex="-1">ITypeStore <a class="header-anchor" href="#itypestore" aria-hidden="true">#</a></h2><p>You wouldn&#39;t typically interact directly with an <code>ITypeStore</code> implementation. Each event type is stored in the type store using its fully qualified assembly type. Since this is a rather significantly sized string it is assigned a unique <code>Guid</code> and this identifier is used when storing events.</p><h3 id="get-2" tabindex="-1">Get <a class="header-anchor" href="#get-2" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Get</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Type</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">type</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>Returns the <code>Guid</code> identifier for the given <code>type</code>.</p><h3 id="add-1" tabindex="-1">Add <a class="header-anchor" href="#add-1" aria-hidden="true">#</a></h3><div class="language-c#"><pre><code><span class="line"><span style="color:#FFCB6B;">Guid</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Add</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Type</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">type</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><p>Adds a new <code>type</code> to the store and returns the <code>Guid</code> identifier assigned to it.</p></div></div><!----></main><!--[--><!--]--><footer class="VPContentDocFooter" data-v-82173214 data-v-a42cc842><!----><a class="next-link" href="/shuttle-recall/events/sql.html" data-v-a42cc842><span class="desc" data-v-a42cc842>Next <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="vt-link-icon" data-v-a42cc842><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></span><span class="title" data-v-a42cc842>SQL</span></a></footer></div></div></div></div><div class="visually-hidden" aria-live="polite" data-v-51944a74>Events has loaded</div></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"events_overview.md\":\"1e25aeda\",\"events_sql.md\":\"2c67a663\",\"getting-started.md\":\"9ea3d88d\",\"index.md\":\"8787a357\",\"projections_overview.md\":\"a05d1140\",\"projections_sql.md\":\"ef688dab\",\"why.md\":\"2e4aed71\"}")</script>
    <script type="module" async src="/shuttle-recall/assets/app.adabc9dd.js"></script>
    
  </body>
</html>